<app-card
  [title]="title"
  [changeType]="changeType"
  [formGroup]="createUserForm"
  (create)="onCreateUser()"
  (delete)="onDeleteUser()"
  [showSaveButtonOnEditMode]="false">
  <form [formGroup]="createUserForm" #myForm="ngForm">
    <mat-form-field class="mb-4 w-full" appearance="outline">
      <mat-label>Felhasználónév</mat-label>
      <input matInput type="text" formControlName="username" required />
      <mat-error *ngIf="username?.hasError('required') && username?.touched">
        Kötelező mező!
      </mat-error>
      <mat-error *ngIf="username?.hasError('usernameExists')"> Username already exists. </mat-error>
    </mat-form-field>

    <mat-form-field class="mb-4 w-full" appearance="outline">
      <mat-label>Jelszó</mat-label>
      <input matInput type="password" formControlName="password" required />
      <mat-error *ngIf="password?.invalid && password?.touched">Kötelező mező!</mat-error>
    </mat-form-field>

    @if (changeType === ChangeTypeEnum.EDIT) {
      <button
        mat-flat-button
        class="mb-8 w-full"
        [disabled]="createUserForm.controls.password.invalid"
        (click)="onPasswordChange()">
        Jelszó módosítása
      </button>
    }

    <mat-form-field class="mb-4 w-full" appearance="outline">
      <mat-label>Szerepkör</mat-label>
      <mat-select formControlName="role">
        <mat-option [value]="RoleEnum.ROLE_USER">Felhasználó</mat-option>
        <mat-option [value]="RoleEnum.ROLE_ADMIN">Adminisztrátor</mat-option>
      </mat-select>
      <mat-error *ngIf="role?.invalid && role?.touched">Kötelező mező!</mat-error>
    </mat-form-field>
  </form>
  <div class="mt-4">
    <mat-form-field class="location-chips w-full" appearance="outline">
      <mat-chip-grid #chipList>
        <!-- Display selected locations as chips -->
        <mat-chip-row
          color="primary"
          highlighted
          *ngFor="let location of selectedLocations"
          [removable]="true"
          (removed)="removeLocation(location)">
          {{ location.shortName }}
          <button matChipRemove>
            <mat-icon>cancel</mat-icon>
          </button>
        </mat-chip-row>

        <!-- Autocomplete input for selecting new locations -->
        <input
          placeholder="Telephelyek"
          [matAutocomplete]="auto"
          [formControl]="locationControl"
          [matChipInputFor]="chipList" />
      </mat-chip-grid>

      <!-- Autocomplete dropdown that displays filtered locations from the server -->
      <mat-autocomplete
        #auto="matAutocomplete"
        (optionSelected)="selectLocation($event.option.value)">
        <mat-option *ngFor="let location of filteredLocations" [value]="location">
          {{ location.shortName }}
        </mat-option>
      </mat-autocomplete>
    </mat-form-field>
  </div>
</app-card>
